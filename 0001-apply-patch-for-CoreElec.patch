From 883d49360e07e90072cc1e9a2d31e2d911cd4457 Mon Sep 17 00:00:00 2001
From: "guoxing.pei" <guoxing.pei@t2mobile.com>
Date: Tue, 29 Nov 2022 03:23:28 +0000
Subject: [PATCH] apply patch for CoreElec

---
 drivers/amlogic/media/enhancement/amvecm/amcsc.c | 3 +--
 drivers/block/floppy.c                           | 3 +--
 drivers/hid/Makefile                             | 1 +
 drivers/hid/hid-core.c                           | 2 ++
 drivers/hid/hid-ids.h                            | 2 ++
 include/uapi/linux/input.h                       | 2 ++
 net/bluetooth/l2cap_core.c                       | 1 +
 7 files changed, 10 insertions(+), 4 deletions(-)

diff --git a/drivers/amlogic/media/enhancement/amvecm/amcsc.c b/drivers/amlogic/media/enhancement/amvecm/amcsc.c
index 2134346c..6fafc0b7 100644
--- a/drivers/amlogic/media/enhancement/amvecm/amcsc.c
+++ b/drivers/amlogic/media/enhancement/amvecm/amcsc.c
@@ -3972,8 +3972,7 @@ uint32_t sink_hdr_support(const struct vinfo_s *vinfo)
 
 	/* when policy == follow sink(0) or force output (2) */
 	/* use force_output */
-	if ((get_force_output() != 0)
-	&& (get_hdr_policy() != 1)) {
+	if ((get_force_output() != 0)) {
 		switch (get_force_output()) {
 		case BT709:
 		case BT_BYPASS:
diff --git a/drivers/block/floppy.c b/drivers/block/floppy.c
index 64a3dae5..f4f4beb5 100644
--- a/drivers/block/floppy.c
+++ b/drivers/block/floppy.c
@@ -5004,8 +5004,7 @@ static const struct pnp_device_id floppy_pnpids[] = {
 	{"PNP0700", 0},
 	{}
 };
-
-MODULE_DEVICE_TABLE(pnp, floppy_pnpids);
+/* MODULE_DEVICE_TABLE(pnp, floppy_pnpids); */
 
 #else
 
diff --git a/drivers/hid/Makefile b/drivers/hid/Makefile
index 58b2922d..e1b5b58d 100644
--- a/drivers/hid/Makefile
+++ b/drivers/hid/Makefile
@@ -101,6 +101,7 @@ obj-$(CONFIG_HID_TWINHAN)	+= hid-twinhan.o
 obj-$(CONFIG_HID_UCLOGIC)	+= hid-uclogic.o
 obj-$(CONFIG_HID_LED)		+= hid-led.o
 obj-$(CONFIG_HID_XINMO)		+= hid-xinmo.o
+obj-$(CONFIG_HID_XPADNEO)	+= hid-xpadneo.o
 obj-$(CONFIG_HID_ZEROPLUS)	+= hid-zpff.o
 obj-$(CONFIG_HID_ZYDACRON)	+= hid-zydacron.o
 
diff --git a/drivers/hid/hid-core.c b/drivers/hid/hid-core.c
index 12a5c53c..6ad6842d 100644
--- a/drivers/hid/hid-core.c
+++ b/drivers/hid/hid-core.c
@@ -2074,6 +2074,8 @@ static const struct hid_device_id hid_have_special_driver[] = {
 	{ HID_USB_DEVICE(USB_VENDOR_ID_MICROSOFT, USB_DEVICE_ID_MS_DIGITAL_MEDIA_600) },
 	{ HID_USB_DEVICE(USB_VENDOR_ID_MICROSOFT, USB_DEVICE_ID_MS_DIGITAL_MEDIA_3KV1) },
 	{ HID_USB_DEVICE(USB_VENDOR_ID_MICROSOFT, USB_DEVICE_ID_MS_POWER_COVER) },
+	{ HID_BLUETOOTH_DEVICE(USB_VENDOR_ID_MICROSOFT, USB_DEVICE_ID_MS_XBOX_ONE_S) },
+	{ HID_BLUETOOTH_DEVICE(USB_VENDOR_ID_MICROSOFT, USB_DEVICE_ID_MS_XBOX_ONE_S_2016) },
 	{ HID_USB_DEVICE(USB_VENDOR_ID_MONTEREY, USB_DEVICE_ID_GENIUS_KB29E) },
 	{ HID_USB_DEVICE(USB_VENDOR_ID_MSI, USB_DEVICE_ID_MSI_GT683R_LED_PANEL) },
 #if IS_ENABLED(CONFIG_HID_NINTENDO)
diff --git a/drivers/hid/hid-ids.h b/drivers/hid/hid-ids.h
index 398d19e5..7279f4df 100644
--- a/drivers/hid/hid-ids.h
+++ b/drivers/hid/hid-ids.h
@@ -748,6 +748,8 @@
 #define USB_DEVICE_ID_MS_TYPE_COVER_PRO_3_JP 0x07dd
 #define USB_DEVICE_ID_MS_TYPE_COVER_PRO_4_JP 0x07e9
 #define USB_DEVICE_ID_MS_POWER_COVER     0x07da
+#define USB_DEVICE_ID_MS_XBOX_ONE_S         0x02fd
+#define USB_DEVICE_ID_MS_XBOX_ONE_S_2016    0x02e0
 
 #define USB_VENDOR_ID_MOJO		0x8282
 #define USB_DEVICE_ID_RETRO_ADAPTER	0x3201
diff --git a/include/uapi/linux/input.h b/include/uapi/linux/input.h
index f561c0eb..6bbb1fd4 100644
--- a/include/uapi/linux/input.h
+++ b/include/uapi/linux/input.h
@@ -24,6 +24,8 @@
 
 struct input_event {
 	struct timeval time;
+#define input_event_sec time.tv_sec
+#define input_event_usec time.tv_usec
 	__u16 type;
 	__u16 code;
 	__s32 value;
diff --git a/net/bluetooth/l2cap_core.c b/net/bluetooth/l2cap_core.c
index 204b6ebd..e100712f 100644
--- a/net/bluetooth/l2cap_core.c
+++ b/net/bluetooth/l2cap_core.c
@@ -4252,6 +4252,7 @@ static inline int l2cap_config_rsp(struct l2cap_conn *conn,
 		}
 		goto done;
 
+	case L2CAP_CONF_UNKNOWN:
 	case L2CAP_CONF_UNACCEPT:
 		if (chan->num_conf_rsp <= L2CAP_CONF_MAX_CONF_RSP) {
 			char req[64];
-- 
2.17.0

